<!DOCTYPE html>
<!--Copyright Michał Pietruszka 2017.-->
<html>
<head>
    <style>
        #map {
            height: 570px;
            width: 100%;
			z-index:0;
			margin-bottom:5px;			  
			box-shadow: 3px 2px 11px 2px rgba(0,0,0,0.2) ;
        }
		#legend {
			width: 50px;
			font-family: Arial, sans-serif;
			background: #fff;
			padding: 7px;
			margin: 1px;
			border: 1px solid #000;
       }
	   .modeClass
			{
				border-style: solid;
				border-width: 1px;
				border-color: #c7ad88;
			}
	   .dropbtn {
			background-color: #64706c;
			color: white;
			padding: 16px;
			font-size: 16px;
			border: none;
			cursor: pointer;
			margin-bottom: 2px;
			min-width: 140px; 
			width: 100%;
			max-width: 140px;
		}
		.dropbtn:hover, .dropbtn:focus {
			background-color: #A3AEAA;
		}
		.dropdown {
			position: relative;
		}
		.dropdown-content {
			display: none;
			position: absolute;
			background-color: #f9f9f9;
			min-width: 140px;
			width: 100%;
			max-width: 140px;
			box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
			z-index: 1;
		}
		.dropdown-content a {
			color: black;
			padding: 12px 16px;
			text-decoration: none;
			display: block;
		}
		.dropdown a:hover {background-color: #f1f1f1}
		.show {display:block;}
		body {
			background-color: #c7ad88;
		}
		.sidenav1 {
		height: 25%; /* 100% Full-height */
		width: 0; /* 0 width - change this with JavaScript */
		position: fixed; /* Stay in place */
		bottom: 0;
		right: 0;
		background-color: #c7ad88; 
		z-index: 1;
		overflow-x: hidden; /* Disable horizontal scroll */
		padding-top: 60px; /* Place content 60px from the top */
		transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
		}
		.closebtn {
			position: absolute;
			top: 0;
			right: 25px;
			font-size: 36px;
			margin-left: 50px;
			color:white;
			text-decoration: none;
		}
		.dymek
			{
				margin: -7px 0;
				width: 150px;
				font-family: Verdana;
			}

			.dymek h4
			{
				font-weight: bold;
				font-size: 14px;
				border-bottom: 2px solid orange;
				padding-bottom: 2px;
				padding-left: 16px;
				margin-bottom: 2px;
				color: black;
				background: url(http://labs.google.com/ridefinder/images/mm_20_red.png) no-repeat 0 0 #ffffff;
			}
			.dymek img
			{	
				float: right;
				border: 1px solid black;
				padding: 1px;
				margin: 0 0 0 6px;
			}

			.dymek p
			{
				width:70px;
				word-wrap: break-word;     
				white-space: -moz-pre-wrap;
				white-space: pre-wrap;
				text-align: justify;
				font-size: 10px;
				color: #676767;
			}

			.dymek a:hover
			{
				color: black;
				text-decoration: underline;
			}
			.autocomplete {
			  display: inline-block;
			  -webkit-box-sizing: border-box;
			  -moz-box-sizing: border-box;
			  box-sizing: border-box;
			  margin: 10px;
			  padding: 10px 20px;
			  border: 1px solid #b7b7b7;
			  -webkit-border-radius: 3px;
			  border-radius: 3px;
			  font: normal 16px/normal "Times New Roman", Times, serif;
			  color: rgba(56,47,47,1);
			  -o-text-overflow: clip;
			  text-overflow: clip;
			  background: rgba(252,252,252,1);
			  -webkit-box-shadow: 3px 2px 11px 2px rgba(0,0,0,0.2) ;
			  box-shadow: 3px 2px 11px 2px rgba(0,0,0,0.2) ;
			  text-shadow: 1px 1px 0 rgba(255,255,255,0.66) ;
			  -webkit-transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
			  -moz-transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
			  -o-transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
			  transition: all 200ms cubic-bezier(0.42, 0, 0.58, 1);
			}
    </style>
	<title>Przychodnie lekarskie w Warszawie</title>
	<link rel="icon" type="image/gif" href="http://etf2l.org/images/icons/16x16_Medic.png" />
	<meta charset="UTF-8">
</head>
<body>
    <div id="naglowek" style="font-family: Garamond; background-color:#935347;margin-top:15px;margin-bottom:15px; width:100%; font-size: 48px; color: #ede9ce;">
		<center><img height="40" width="40" align="center" src="https://cdn4.iconfinder.com/data/icons/medical-and-health-2/128/Medical_heart_rate-512.png"/><font face="Impact" size="6" color="#ede9ce">&nbsp Przychodnie lekarskie w Warszawie</font></center>
	</div>
	<div class="modeClass" id="DRIVING" style="background-color:white; width:20px; margin-right:15px;"><img src="http://www.privateproperty.com.ng/content/icons/car.png"/></div>
	<div class="modeClass" id="WALKING" style="background-color:white;width:20px; margin-right:15px;"><img src="http://valledelpensare.it/oggetti/MAPS_Poi/walk.png"/></div>
	<div class="modeClass" id="BICYCLING" style="background-color:white;width:20px; margin-right:15px;"><img src="http://store.rodalink.com.sg/images/detailed/2/bike.jpg?t=1470195135"/></div>
	<div class="modeClass" id="TRANSIT" style="background-color:white;width:20px; margin-right:15px;"><img src="http://www.japanican.com/~/media/common/images/system/transfericon/T1.png"/></div>
	<div id="dost_dar" style="width:10px;height:10px;background-color:#FB6467;">    &nbsp;&nbsp;&nbsp;Darmowa</div>
	<div id="dost_plat" style="width:10px;height:10px;background-color:#D1FBDC;">    &nbsp;&nbsp;&nbsp;Platna</div>
	<div id="legend">Wizyta</div>
    <input id="address" class="autocomplete" type="textbox" value="Wpisz swoje położenie">
	<div id="mySidenav1" class="sidenav1">
		<a href="javascript:void(0)" class="closebtn" onclick="closeNavig()">&times;</a>
	</div>
	<div style="width:13%  float: left;display: inline-block;">
		<div id="KomunFlt" style="width: 150px;color:#ffffff;margin-bottom:5px;">Sortujesz po</div>		
		<div id="ClearFlt"  onclick="czysc()"; style="width: 150px;color:#ffffff;margin-bottom:5px;text-align:right;"><font size=1>Wyczyść filtr</font></div>
		<div id="godzin" class="dropdown">
			  <button class="dropbtn" onclick="myFunction1()" >Dostępność</button>
				  <div id="myDropdown1" class="dropdown-content">      
					<a onclick="dropdown(this.innerHTML);">Otwarte</a>
					<a onclick="dropdown(this.innerHTML);">Zamknięte</a>
				  </div>
		</div>
		<div id="godzin" class="dropdown">
			  <button class="dropbtn" onclick="myFunction2()">Koszt</button>
				  <div id="myDropdown2" class="dropdown-content">      
					<a onclick="dropdown(this.innerHTML);">Darmowa</a>
					<a onclick="dropdown(this.innerHTML);">Płatna</a>					
				  </div>
		</div>
		<div id="specjal" class="dropdown">
			  <button class="dropbtn" onclick="myFunction3()">Specjalizacja</button>
				  <div id="myDropdown3" class="dropdown-content">      
					<a onclick="dropdown(this.innerHTML);">pediatria</a>
					<a onclick="dropdown(this.innerHTML);">stomatologia</a>
					<a onclick="dropdown(this.innerHTML);">dermatologia</a>
					<a onclick="dropdown(this.innerHTML);">rodzinny</a>
				  </div>
		</div>
		<div id="draw"><button onclick="filtrowanie()" style="background-color: #64706c;padding:font-size: 16px;border: none;cursor: pointer; 16px;margin-left:50px;color:white;height:30px;text-align:center;">Filtruj!</button></div>
		<div id="draw"><button onclick="fiveNearest()" style="margin-top:50px;" class="dropbtn">Znajdź 5 najbliższych</button></div>
		<div id="draw"><button onclick="drawning()" style="margin-top:30px;" class="dropbtn">Narysuj obszar</button></div>
		<div id="draw"><button onclick="Enddrawning()" style="margin-top:50px;" class="dropbtn">Wyczyść mapę</button></div>
	</div>
	<div id="map" style="width:87%; float: right;"></div> 
	<div id="image" style="width: 1000px; height: 150px; display: inline-block;"></div>	
	<div id="pano" style="width: 300px; height: 150px; display: inline-block; z-index:0;"></div>
    <script src="map1.js"></script><script language="JavaScript" type="text/javascript" src="jquery-3.1.1.min.js"></script>
    <script>
			class Hospital {
			constructor(lat, lng, prop) {
				this.lat = lat;
				this.lng = lng;
				this.prop = prop;
				this.crd = {lat: lng,lng: lat};
			}}
		var map;
		var pos = { lat: 52.220, lng: 21.010 };//startowy, domyślny punkt
		var marker;
		var hospital=[];
		var infoWindow;
		var drawingManager;
		var modeTr='DRIVING';//przekazywanie z jquery//default
		var markers = [];
		var imageIcon;
		var navWindow=[];
		var circle_d=[];
		var circle_p=[];
		var infowindow1;
		var fltr=[];
		var licznikNav=-1;//zmienna do ukrywania dymków nawigacji
		var img = new Image();
		var img1 = new Image();
		var img2 = new Image(300,150);
        function initMap() {
            var styledMapType = new google.maps.StyledMapType(
                [
                { elementType: 'geometry', stylers: [{ color: '#242f3e' }] },
                { elementType: 'labels.text.stroke', stylers: [{ color: '#242f3e' }] },
                { elementType: 'labels.text.fill', stylers: [{ color: '#746855' }] },
                {
                    featureType: 'administrative.locality',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#d59563' }]
                },
                {
                    featureType: 'road',
                    elementType: 'geometry',
                    stylers: [{ color: '#38414e' }]
                },
                {
                    featureType: 'water',
                    elementType: 'geometry',
                    stylers: [{ color: '#17263c' }]
                },
                 {
                     featureType: 'poi.park',
                     elementType: 'geometry',
                     stylers: [{ color: '#263c3f' }]
                 },
                 {
                     featureType: 'transit',
                     elementType: 'geometry',
                     stylers: [{ color: '#2f3948' }]
                 },
                {
                    featureType: 'transit.station',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#d59563' }]
                },
                {
                    featureType: 'poi.park',
                    elementType: 'labels.text.fill',
                    stylers: [{ color: '#6b9a76' }]
                }
                ],
                { name: 'Tryb nocny' }
            );
            map = new google.maps.Map(document.getElementById('map'),
             {
                 zoom: 13,
                 maxZoom: 20,
                 minZoom: 0,
                 mapTypeId: 'roadmap',
                 mapTypeControlOptions: { mapTypeIds: ['roadmap', 'satellite', 'styled_map'] },
                 tilt: 45,
                 center: pos
             });

            map.mapTypes.set('styled_map', styledMapType);
			
			infowindow1 = new google.maps.InfoWindow({maxWidth: 150
				});
				
			imageIcon = {
                url: 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                anchor: new google.maps.Point(0, 32)
             };
			 
            marker = new google.maps.Marker(
            {
                position: pos,
                draggable: false,
				animation: google.maps.Animation.DROP,
                icon: imageIcon,
                map: map
            });

			//wczytywanie GEOJSON do tablicy
			var expected_result_c = data.features.map(function (el) {
			return el.geometry.coordinates;
			});
			var expected_result_p = data.features.map(function (el) {
			return el.properties;
			});
			
			for (i = 0; i < expected_result_p.length; i++) { 
				hospital.push(new Hospital(expected_result_c[i][0],expected_result_c[i][1],expected_result_p[i]));
			}
			//odczyt i zapis stref dostaw
			for (var i = 0; i < 12; i++) {
							for(var j=0;j<hospital[i*2+12].lat.length;j++)//przeróbka do postaci lat:XX,lng:YY
							{
								hospital[i*2+12].lat[j]={lat:hospital[i*2+12].lat[j][1], lng:hospital[i*2+12].lat[j][0]};
							}

							circle_d[i]= new google.maps.Polygon({
								  map: map,
								  paths: hospital[i*2+12].lat,
								  fillColor: '#FF0000',
								  fillOpacity: 0.3,
								  strokeWeight: 0.8				
							});			
							circle_d[i].setMap(null);

							for(var j=0;j<hospital[i*2+13].lat.length;j++)//przeróbka do postaci lat:XX,lng:YY-inaczej nie przyjmuje
							{
								hospital[i*2+13].lat[j]={lat:hospital[i*2+13].lat[j][1], lng:hospital[i*2+13].lat[j][0]};
							}
							circle_p[i]= new google.maps.Polygon({
								  map: map,
								  paths: hospital[i*2+13].lat,
								  fillColor: '#90EE90',
								  fillOpacity: 0.3,
								  strokeWeight: 0.8				
							});	
							circle_p[i].setMap(null);
			}
			//odczyt i zapis markerów (pozycji przychodni)
			for (var i = 0; i < 12; i++) {
				markers[i] = new google.maps.Marker({
					position: new google.maps.LatLng(hospital[i].lng, hospital[i].lat),
					icon: 'icon3.png',
					map: map,
					id: i,
					vis: false
				})
				markers[i].index = i;
				//słuchacz zdrzeń, kliknięcie markera
				google.maps.event.addListener(markers[i], 'click', function () {
					if(markers[this.index].vis==false){
						var id=this.index;
						
						infowindow1.setContent(
							'<div id="content" class="dymek"><h4>'+hospital[id].prop.name+'</h4><img src="'+hospital[id].prop.img+'" onclick="showImages('+id+')" height="51" width="71" alt="obraz" /><p>'+hospital[id].prop.adres+'<br/></p><font size="0.1px">Kliknij na zdjęcie, aby wyświetlić więcej</font><br/><a style="color:green;width:120px;font-size: 10px;" href="'+hospital[id].prop.url+'">'+hospital[id].prop.url+'</a><br/></p></div>'+'<button style="height:20px;width:auto;background-color:#64706c;margin-top:10px;color:white"onclick="navigate('+id+')">Wyznacz trasę</button>');
						infowindow1.open(map,markers[id]);
						map.panTo(markers[id].getPosition());
						
						for(var i=0;i < markers.length; i++) 
						{
							circle_p[i].setMap(null);circle_d[i].setMap(null);
						}	
						circle_d[this.index].setMap(map);
						circle_p[this.index].setMap(map);	
						
						markers[this.index].vis=true;
					}
					else if(markers[this.index].vis==true)
					{
						circle_d[this.index].setMap(null);
						circle_p[this.index].setMap(null);
						markers[this.index].vis=false;
						pano.style.visibility='hidden'; 	
						image.style.visibility='hidden'; 	
						infowindow1.close(map,markers[this.index]);						
					}
				})
			};
			//Legenda
			var legend = document.getElementById('legend');
			map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
			legend.appendChild(dost_plat);
			legend.appendChild(dost_dar);
			//Przycisku trybu transportu
			for (var i=0;i<4;i++){//try forEach
				var modeTran =  document.getElementsByClassName('modeClass')[i];
				map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(modeTran);
			}
			//Przycisk do startu filtrowania
			var startFlt = document.getElementById('startFlt');
			map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(startFlt);
			//Autocomplete,geokodowanie
			var input = document.getElementById('address');
			var autocomplete = new google.maps.places.Autocomplete(input);
			map.controls[google.maps.ControlPosition.RIGHT_TOP].push(input);
			autocomplete.addListener('place_changed', function() {
				var place = autocomplete.getPlace();
				if (!place.geometry) {
				window.alert("No details available for input: '" + place.name + "'");
				return;
				}

				if (place.geometry.viewport) {
					map.fitBounds(place.geometry.viewport);
				} 
				else {
					map.setCenter(place.geometry.location);
					map.setZoom(17);
				}
				marker.setPosition(place.geometry.location);
				console.log(place.geometry.location.lat());
				pos.lat=place.geometry.location.lat();
				pos.lng=place.geometry.location.lng();
				marker.setVisible(true);
			});
			
			
            infoWindow = new google.maps.InfoWindow({ map: map});//okno do komunikatu znalezienia lokalizacji
			infoWindow.close();//przy ładowaniu strony pojawiała się domyślnie w rogu, dlatego ukrycie
			//Geolokalizacja
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
					
					geocoder.geocode({'location': pos}, function(results, status) {
						if (status === 'OK') {
							document.getElementById('address').value=results[1].formatted_address;
							} else {
							}
						})
					
                    infoWindow.setPosition(pos);
                    infoWindow.setContent("Lokalizacja znaleziona");
                    map.setCenter(pos);
					marker.setPosition(pos);
					
					infoWindow.open(map,marker);
                    map.setZoom(16);
                    map.panTo(marker.position);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            }
            else {
                handleLocationError(false, infoWindow, map.getCenter());
            }

            var geocoder = new google.maps.Geocoder();
			//route
			directionsService = new google.maps.DirectionsService;//object to send and receive direction requests
			directionsDisplay = new google.maps.DirectionsRenderer({map: map});//object to render the returned route on the map
            //rysowanie
		    drawingManager = new google.maps.drawing.DrawingManager({
				drawingControl: true,
				drawingMode: google.maps.drawing.OverlayType.POLYGON,
				drawingControlOptions: {
				position: google.maps.ControlPosition.TOP_CENTER,
				drawingModes:  [google.maps.drawing.OverlayType.POLYGON]
				}
			});
			//kiedy skończy rysowanie
			google.maps.event.addListener(drawingManager, 'polygoncomplete', function(polygon) {
				drawingManager.setDrawingMode(null);
				for(var i=0;i<markers.length;i++)
				{
				if(google.maps.geometry.poly.containsLocation(new google.maps.LatLng(hospital[i].lng, hospital[i].lat),polygon)==false)
					markers[i].setMap(null);
				}
			});
			//usuwanie rysowanych poligonów, wyłaczenie managera
			google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
				drawingManager.setMap(null);
				event.overlay.setMap(null); 
			});
		}
		var fltr;
		//dopisanie pozycji filtrowania do komunikatu
		function dropdown(val) {
			if(fltr.includes(val)==true || (fltr.includes("Otwarte")==true && val=="Zamknięte"))
			{
				alert("Nie możesz sortować w ten sposób");
			}
			else if(fltr.includes(val)==true || (fltr.includes("Zamknięte")==true && val=="Otwarte"))
			{
				alert("Nie możesz sortować w ten sposób");
			}
			else if(fltr.includes(val)==true || (fltr.includes("Płatna")==true && val=="Darmowa"))
			{
				alert("Nie możesz sortować w ten sposób");
			}
			else if(fltr.includes(val)==true || (fltr.includes("Darmowa")==true && val=="Płatna"))
			{
				alert("Nie możesz sortować w ten sposób");
			}
			else
			{
				document.getElementById('KomunFlt').innerHTML += " "+ val;
				fltr=document.getElementById('KomunFlt').innerHTML.split(" ");
			}
		}
		//filtrowanie
		function filtrowanie()
		{	if(fltr.length!=0)
			{
				map.setZoom(12);
				map.panTo(pos);
				var currentdate = new Date(); 
				aktD=currentdate.getDay();
				aktH=currentdate.getHours();
				aktM=currentdate.getMinutes();
				var fltRes=new Array(hospital.length/3).fill(0);
				for (var i = 0; i < hospital.length/3 ; i++) {
					var strOt = hospital[i].prop.godzin_otwar[aktD];
					var strZm = hospital[i].prop.godzin_zamk[aktD];
					var strAk = String(aktH+':'+aktM);
					if(fltr.includes('Otwarte')==true || fltr.includes('Zamknięte')==true)
					{
						if (fltr[fltr.indexOf('Otwarte')]=="Otwarte") {
							if(strOt < strAk && strZm > strAk)
								fltRes[i]++;
						}
						if (fltr[fltr.indexOf('Zamknięte')]=="Zamknięte") {
							if(strOt > strAk || strZm < strAk)
								fltRes[i]++;
						}
					}
					if(fltr.includes('Darmowa')==true || fltr.includes('Płatna')==true || fltr.includes('Żadna')==true)
					{
						if (fltr[fltr.indexOf('Darmowa')]=="Darmowa") {
							if(google.maps.geometry.poly.containsLocation(new google.maps.LatLng(pos.lat, pos.lng),circle_d[i])==true)
								fltRes[i]++;
						}
						if (fltr[fltr.indexOf('Płatna')]=="Płatna") {
							if(google.maps.geometry.poly.containsLocation(new google.maps.LatLng(pos.lat, pos.lng),circle_p[i])==true)
								fltRes[i]++;
						}
					}
					if(fltr.includes('dermatologia')==true || fltr.includes('rodzinny')==true || fltr.includes('stomatologia')==true || fltr.includes('pediatria')==true)
					{
						if (hospital[i].prop.specjalizacja.includes(fltr[fltr.length-1])){
								fltRes[i]++;
						}				
					}
				}
				for (var i = 0; i < hospital.length/3 ; i++) {
					if(fltRes[i]!=fltr.length-2)
					{
						if(fltr.length!=0)
						{
							markers[i].setMap(null);
							circle_p[i].setMap(null);
							circle_d[i].setMap(null);
						}
					}
				}
			}
		}
		//rozwijanie listy guzików
		function myFunction1() {
			document.getElementById("myDropdown1").classList.toggle("show");
			document.getElementById("myDropdown2").classList.remove('show');
			document.getElementById("myDropdown3").classList.remove('show');
		}
		function myFunction2() {
			document.getElementById("myDropdown2").classList.toggle("show");
			document.getElementById("myDropdown1").classList.remove('show');
			document.getElementById("myDropdown3").classList.remove('show');

		}
		function myFunction3() {
			document.getElementById("myDropdown3").classList.toggle("show");
			document.getElementById("myDropdown1").classList.remove('show');
			document.getElementById("myDropdown2").classList.remove('show');
		}
		//zwijanie guzików gdy kliknięto poza obszar
		window.onclick = function(event) {
		  if (!event.target.matches('.dropbtn')) {

			var dropdowns = document.getElementsByClassName("dropdown-content");
			var i;
			for (i = 0; i < dropdowns.length; i++) {
			  var openDropdown = dropdowns[i];
			  if (openDropdown.classList.contains('show')) {
				openDropdown.classList.remove('show');
			  }
			}
		}}
		//który rodzaj tranportu wybrano
		$(function () {
			$('div.modeClass').click(function() {
			modeTr=this.id;     
			var elements = document.getElementsByClassName("modeClass");
			for (var i = 0; i < 4; i++) {
				elements[i].style.border = "solid 1px #c7ad88";
			}
			document.getElementById(this.id).style.border = "solid 2px #c7ad88";
			});
		});
		//nawigowanie do punktu
		function navigate(i){
			if(pos != null){
				var daneTrasy= directionsService.route({
						origin: pos,
						destination: markers[i].getPosition(),
						travelMode: google.maps.TravelMode[modeTr]
					}, 
					function(response, status) {
						if (status == google.maps.DirectionsStatus.OK) {
						    directionsDisplay.setDirections(response);
						    licznikNav=licznikNav+1;
							if (licznikNav!=0) {navWindow[licznikNav-1].close();}
							navWindow[licznikNav] = new google.maps.InfoWindow({});	
						    navWindow[licznikNav].setContent(response.routes[0].legs[0].distance.text + "<br>" + response.routes[0].legs[0].duration.text + " "+'<button style="margin-left:5px;width:20px;height:20px;background: url(https://www.salto-youth.net/salto/common/presentation/web/public/img/icon_info_small.png)" onclick="openNavig('+i+')"></button>');
							infoWindow.close();
							navWindow[licznikNav].setPosition(pos);
						    navWindow[licznikNav].open(map);
							circle_d[i].setMap(null);
							circle_p[i].setMap(null);
							//wskazówki
							directionsDisplay.setPanel(document.getElementById('mySidenav1'));
						} else {
						 alert('Directions request failed due to ' + status);
						}
					}
				);
			}
			else {window.alert("Gdzies jesteś?")}
		}
		//pokazanie zdjęć i StreetView
		function showImages(id)
		{
			document.body.scrollTop = document.documentElement.scrollTop = 500;

			panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'), panoramaOptions = {position: new google.maps.LatLng(hospital[id].lng,hospital[id].lat)});
			pano.style.visibility='visible';
						//Zdjęcia
						
						var t=hospital[id].lng;//??
						var tt=hospital[id].lat;
						var center = new google.maps.LatLng(hospital[id].lng, hospital[id].lat);
						var maxDistanceFromCenter = 50; //meters						
						var streetViewService = new google.maps.StreetViewService();
						streetViewService.getPanoramaByLocation(center, maxDistanceFromCenter, function (streetViewPanoramaData, status) {
						if (status === google.maps.StreetViewStatus.OK) {
							img.src  = "https://maps.googleapis.com/maps/api/streetview?size=350x150&location="+t+","+tt+"&fov=90&heading=300&pitch=10&key=AIzaSyC-lKW5lZz1a5dvm7LAZ48F3EtTmesSp1g";
							img1.src = "https://maps.googleapis.com/maps/api/streetview?size=350x150&location="+t+","+tt+"&fov=90&heading=120&pitch=10&key=AIzaSyC-lKW5lZz1a5dvm7LAZ48F3EtTmesSp1g";
							img2.src = hospital[id].prop.img;
							image.appendChild(img2);
							image.appendChild(img);
							image.appendChild(img1);
							image.style.visibility='visible';
							} 
						else {
								console.log('Nie znaleziono tego obrazka :(');
							}
						  });
		}
		//pięć najbliższych
		function fiveNearest()
		{
			var distanceService = new google.maps.DistanceMatrixService();

			distanceService.getDistanceMatrix({
			origins: [pos],
			destinations: [hospital[0].crd,hospital[1].crd,hospital[2].crd,hospital[3].crd,hospital[4].crd,hospital[5].crd,hospital[6].crd,hospital[7].crd,hospital[8].crd,hospital[9].crd,hospital[10].crd,hospital[11].crd],
			travelMode: google.maps.TravelMode[modeTr],
			unitSystem: google.maps.UnitSystem.METRIC,
			drivingOptions: {
				departureTime: new Date(Date.now() + 2000000),  // millisekundy,33minuty
				trafficModel: 'bestguess'
			},		
			avoidHighways: false,
			avoidTolls: false
		},
		function (response, status) {
			if (status !== google.maps.DistanceMatrixStatus.OK) {
				console.log('Error:', status);
			} else {
				duration=[];
				for(var i=0;i<response.rows[0].elements.length;i++)
				{
					duration[i]={val:response.rows[0].elements[i].duration_in_traffic.value,id:i};
				}
				duration.sort(function(a, b) {//sortowanie
					return parseFloat(a.val) - parseFloat(b.val);
				});
				duration=duration.slice(5,hospital.length/3);//obcinanie tylko 5 obiektów
				Enddrawning();
				
				var bounds=new google.maps.LatLngBounds();
				for(var i=0;i<duration.length;i++)
				{	bounds.extend(new google.maps.LatLng(hospital[duration[i].id].lng,hospital[duration[i].id].lat));

							markers[duration[i].id].setMap(null);
							circle_p[i].setMap(null);circle_d[i].setMap(null);infowindow1.close();	
				}
				}
				//map.setZoom(12);
				//map.panTo(pos);
				bounds.extend(new google.maps.LatLng(pos.lat,pos.lng));
				map.fitBounds(bounds);
		});
		
		}
		//rysowanie obszaru
		function drawning(){
			drawingManager.setMap(map);	
			map.setZoom(12);
			map.panTo(pos);
			for(var i=0;i < markers.length;i++) //pokaż wszystkie punkty od nowa	
			{
				markers[i].setMap(map);
				circle_p[i].setMap(null);
				circle_d[i].setMap(null);
				infowindow1.close();
			}		
		}
		//wracanie do stanu początkowego	
		function Enddrawning(){
			for(var i=0;i < markers.length;i++) 
			{
				if (navWindow.length!=0) 
				{
					navWindow[navWindow.length-1].close();
				}
				pano.style.visibility='hidden';
				image.style.visibility='hidden';
				markers[i].setMap(map);
				circle_p[i].setMap(null);
				circle_d[i].setMap(null);
				infowindow1.close();
			}		
			directionsDisplay.setMap(null); 
			map.setZoom(12);
			map.panTo(pos);			
			drawingManager.setMap(null);
		}
		//wyczyszczenie filtrowania
		function czysc() {
			map.setZoom(12);
			fltr.length = 0;
			document.getElementById('KomunFlt').innerHTML="Sortujesz po";
			Enddrawning();
		}
		//okno ze wskazówkami-open
		function openNavig() {
			document.getElementById("mySidenav1").style.width = "410px";
		}
		//okno ze wskazówkami-close
		function closeNavig() {
			document.getElementById("mySidenav1").style.width = "0px";
		}
    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC-lKW5lZz1a5dvm7LAZ48F3EtTmesSp1g&libraries=visualization&libraries=drawing,places,geometry&callback=initMap">
    </script>
</body>
</html>